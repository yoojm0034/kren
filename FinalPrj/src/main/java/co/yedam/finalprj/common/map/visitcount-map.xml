<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.yedam.finalprj.common.map.VisitCountMap">
	<insert id="insertVisitor" parameterType="co.yedam.finalprj.common.vo.VisitCountVO">
          INSERT INTO TB_VISITOR (V_DATE) 
          VALUES (SYSDATE)
    </insert>
	<select id="getVisitTotalCount" resultType="int">
		select count(*) 
		from TB_VISITOR
	</select>
	<select id="getVisitToday" resultType="int">
		select count(*) 
		from TB_VISITOR
		where substr(to_char(v_date), 1, 9) = to_date(sysdate, 'yy/MM/dd')
	</select>
	
	<select id="dayCount" resultType="map">
		select b.time, nvl(a.cnt, 0) as cnt
		from (select TO_CHAR(V_DATE,'HH24') as time, count(*) as cnt
		      from tb_visitor                           
		      where to_char(sysdate, 'yyyy/mm/dd') = to_char(v_date, 'yyyy/mm/dd')
		      group by TO_CHAR(V_DATE,'HH24')
		      order by 1) a
		      ,(SELECT level as time, 0 as cnt 
		        FROM DUAL 
		        CONNECT BY LEVEL <![CDATA[<=]]>23
		        union all
		        select 0 , 0 from dual) b
		where  a.time(+) = b.time
		order by b.time
	</select>

</mapper>